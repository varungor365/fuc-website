{% comment %}
  Testimonials Section - Customer Reviews & Testimonials
  Display customer feedback with ratings and carousel
{% endcomment %}

{% schema %}
{
  "name": "Testimonials",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "What Our Customers Say"
    },
    {
      "type": "block_set",
      "id": "testimonials",
      "blocks": [
        {
          "type": "testimonial",
          "name": "Testimonial",
          "settings": [
            {
              "type": "text",
              "id": "customer_name",
              "label": "Customer Name",
              "default": "John Doe"
            },
            {
              "type": "text",
              "id": "customer_title",
              "label": "Customer Title/Role",
              "default": "Fashion Enthusiast"
            },
            {
              "type": "range",
              "id": "rating",
              "label": "Rating",
              "min": 1,
              "max": 5,
              "step": 1,
              "default": 5
            },
            {
              "type": "text",
              "id": "testimonial_text",
              "label": "Testimonial Text",
              "default": "Amazing quality and style. Highly recommend!"
            }
          ]
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Testimonials",
      "blocks": [
        {
          "type": "testimonial",
          "settings": {
            "customer_name": "Sarah Johnson",
            "customer_title": "Fashion Blogger",
            "rating": 5,
            "testimonial_text": "The quality of these products is exceptional. I've been recommending them to all my followers!"
          }
        },
        {
          "type": "testimonial",
          "settings": {
            "customer_name": "Michael Chen",
            "customer_title": "Regular Customer",
            "rating": 5,
            "testimonial_text": "Fast shipping and great customer service. Will definitely buy again."
          }
        },
        {
          "type": "testimonial",
          "settings": {
            "customer_name": "Emma Wilson",
            "customer_title": "Verified Buyer",
            "rating": 5,
            "testimonial_text": "Perfect fit and amazing designs. Exceeded my expectations!"
          }
        }
      ]
    }
  ]
}
{% endschema %}

<section class="testimonials-section">
  <div class="container testimonials-container">
    <h2 class="testimonials-heading">{{ section.settings.heading }}</h2>

    <div class="testimonials-carousel">
      {% for block in section.blocks %}
        <div class="testimonial-card" {{ block.shopify_attributes }}>
          <!-- Rating Stars -->
          <div class="testimonial-rating">
            {% for i in (1..5) %}
              {% if i <= block.settings.rating %}
                <span class="star">★</span>
              {% else %}
                <span class="star empty">☆</span>
              {% endif %}
            {% endfor %}
          </div>

          <!-- Testimonial Text -->
          <p class="testimonial-text">
            "{{ block.settings.testimonial_text }}"
          </p>

          <!-- Customer Info -->
          <div class="testimonial-author">
            <h3 class="author-name">{{ block.settings.customer_name }}</h3>
            {% if block.settings.customer_title != blank %}
              <p class="author-title">{{ block.settings.customer_title }}</p>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>

    <!-- Carousel Navigation -->
    {% if section.blocks.size > 1 %}
      <div class="carousel-nav">
        {% for block in section.blocks %}
          <button class="carousel-dot" data-index="{{ forloop.index0 }}" {% if forloop.first %}active{% endif %}></button>
        {% endfor %}
      </div>
    {% endif %}
  </div>
</section>

<style>
  .testimonials-section {
    padding: 4rem 2rem;
    background: linear-gradient(135deg, #f5f5f5 0%, #fff 100%);
  }

  .testimonials-container {
    max-width: 1200px;
    margin: 0 auto;
  }

  .testimonials-heading {
    font-size: 2rem;
    font-weight: 700;
    text-align: center;
    margin-bottom: 3rem;
  }

  .testimonials-carousel {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
    margin-bottom: 2rem;
  }

  .testimonial-card {
    background: white;
    padding: 2rem;
    border-radius: 8px;
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
    transition: all 0.3s ease;
    border-left: 4px solid #007aff;
  }

  .testimonial-card:hover {
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
    transform: translateY(-4px);
  }

  .testimonial-rating {
    display: flex;
    gap: 0.25rem;
    margin-bottom: 1rem;
  }

  .star {
    color: #ffc107;
    font-size: 1.2rem;
  }

  .star.empty {
    color: #ddd;
  }

  .testimonial-text {
    font-size: 1rem;
    color: #666;
    line-height: 1.6;
    font-style: italic;
    margin: 1rem 0;
  }

  .testimonial-author {
    margin-top: 1.5rem;
    padding-top: 1.5rem;
    border-top: 1px solid #f0f0f0;
  }

  .author-name {
    font-size: 1rem;
    font-weight: 700;
    margin: 0;
    color: #000;
  }

  .author-title {
    font-size: 0.85rem;
    color: #999;
    margin: 0.25rem 0 0;
  }

  .carousel-nav {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
  }

  .carousel-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    border: 2px solid #ddd;
    background: white;
    cursor: pointer;
    transition: all 0.3s;
  }

  .carousel-dot.active {
    background: #007aff;
    border-color: #007aff;
  }

  @media (max-width: 768px) {
    .testimonials-section {
      padding: 2rem 1rem;
    }

    .testimonials-carousel {
      grid-template-columns: 1fr;
    }

    .testimonials-heading {
      font-size: 1.5rem;
    }
  }
</style>

<script>
  (function() {
    const carousel = document.querySelector('.testimonials-carousel');
    const dots = document.querySelectorAll('.carousel-dot');
    const cards = document.querySelectorAll('.testimonial-card');
    let currentIndex = 0;

    if (dots.length > 1) {
      dots.forEach(dot => {
        dot.addEventListener('click', () => {
          const index = parseInt(dot.dataset.index);
          currentIndex = index;
          updateCarousel();
        });
      });

      function updateCarousel() {
        dots.forEach((dot, idx) => {
          dot.classList.toggle('active', idx === currentIndex);
        });

        // Scroll to current card
        if (carousel) {
          const cardWidth = cards[0].offsetWidth + 32; // width + gap
          carousel.scrollLeft = currentIndex * cardWidth;
        }
      }

      // Auto-rotate every 5 seconds
      setInterval(() => {
        currentIndex = (currentIndex + 1) % cards.length;
        updateCarousel();
      }, 5000);
    }
  })();
</script>
