{% assign on_sale = false %}
{% if product.compare_at_price_min > product.price_min %}
  {% assign on_sale = true %}
{% endif %}

{% assign sold_out = true %}
{% if product.available  %}
  {% assign sold_out = false %}
{% endif %}

{% assign new = false %}
{% for tag in product.tags %}
  {% assign tag_handle = tag | handle %}
  {% if tag_handle == 'new' %}
    {% assign new = true %}
  {% endif %}
{% endfor %}

<div class="{% if settings.product_image_crop%}crop_image{% else %}no_crop_image{% endif %} grid-item product-item {% if sold_out %}sold-out{% endif %} {% if on_sale %}on-sale{% endif %}" id="product-{{ product.id }}">
  <div class="product-top">
    <div class="product-grid-image">
      <a href="{{ product.url | within: collection }}" class="product-grid-image">
        <img src="{{ product.featured_image.src | product_img_url: 'compact' }}" alt="{{ product.featured_image.alt | escape }}">
      </a>
    </div>
    
    {% if on_sale or new %}
    <div class="product-label">
      {% if on_sale %}
        <strong class="label" {% if settings.enable_multilang %}data-translate="products.product.sale"{% endif %}>{{ 'products.product.sale' | t }}</strong>
      {% endif %}
      {% if new %}
        <strong class="label new" {% if settings.enable_multilang %}data-translate="products.product.new"{% endif %}>{{ 'products.product.new' | t }}</strong>
      {% endif %}
    </div>
    {% endif %}
    
  </div>
  
  <div class="product-bottom">
    <a class="product-title" href="{{ product.url | within: collection }}">
      {% include 'multilang' with product.title %}
    </a>
    
    {% if settings.display_product_reviews %}
    <span class="shopify-product-reviews-badge" data-id="{{ product.id }}"></span>
    {% endif %}
    
    <div class="price-box">
      {% if on_sale %}
      <p class="sale">
        <span class="old-price">{{ product.compare_at_price_min | money }}</span>
        <span class="special-price">{% if product.price_varies %}{% include 'varies_from' %}{% endif %}{{ product.price_min | money }}</span></p>
      {% else %}
      <p class="regular-product">
        <span>{% if product.price_varies %}{% include 'varies_from' %}{% endif %}{{ product.price_min | money }}</span>
      </p>
      {% endif %}
    </div>
    
    {% comment %}
    {% if sold_out %}
    <p>
      <span class="sold-out-label" {% if settings.enable_multilang %}data-translate="products.product.sold_out"{% endif %}>{{ 'products.product.sold_out' | t }}</span>
    </p>
    {% endif %}
    {% endcomment %}
  </div>
</div>