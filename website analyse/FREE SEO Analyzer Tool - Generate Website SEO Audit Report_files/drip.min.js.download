var _=Object.defineProperty;var f=(t,e,i)=>e in t?_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var r=(t,e,i)=>(f(t,typeof e!="symbol"?e+"":e,i),i);function m(t,e){return Array.isArray(e)?!!e.find(i=>m(t,i)):h(t).classList?t.classList.contains(e):new RegExp("\\b"+e+"\\b").test(t.className)}function h(t){return!(t instanceof Element)&&!(t instanceof HTMLElement)&&!(t instanceof SVGElement)&&t!==window&&t!==document?!1:t}function l(t,e="",i,o){return h(t)&&(t._omns||(t._omns={}),t._omns[e]=i,t.addEventListener(e.split(".")[0],i,o||!1)),t}class u{}r(u,"valid",e=>{const i=document.createElement("input");return i.type="email",i.required=!0,i.value=e,typeof i.checkValidity=="function"?i.checkValidity():/\S+@\S+\.\S+/.test(e)});class p{constructor(){r(this,"bindCheckoutEvents",()=>{if(typeof window._dcq>"u")return;const e=document.body,i=document.querySelector(".woocommerce-billing-fields #billing_email");if(m(e,"logged-in"))return;l(i,"blur",()=>{this.email=i.value;const a=this.getUniqueUrl();if(a&&u.valid(this.email)){const c={email:this.email,username:this.email,abandoned_cart_url:a,tags:["aioseo-abandoned"],success:d=>{d.visitor_uuid&&(this.visitor_uuid=d.visitor_uuid,this.setCookie("aioseo_drip_visitor_uuid",this.visitor_uuid,30))}};this.visitor_uuid&&(delete c.email,c.new_email=this.email),window._dcq.push(["identify",c])}});const o=document.querySelector(".woocommerce-billing-fields #billing_first_name");l(o,"blur",()=>{this.firstName=o.value,this.email=i.value;const a=this.getUniqueUrl();a&&this.firstName.length&&u.valid(this.email)&&window._dcq.push(["identify",{email:this.email,first_name:this.firstName,abandoned_cart_url:a}])});const s=document.querySelector(".woocommerce-billing-fields #billing_last_name");l(s,"blur",()=>{this.lastName=s.value,this.email=i.value;const a=this.getUniqueUrl();a&&this.lastName.length&&u.valid(this.email)&&window._dcq.push(["identify",{email:this.email,last_name:this.lastName,abandoned_cart_url:a}])});const n=document.querySelector(".woocommerce-billing-fields #billing_phone");l(n,"blur",()=>{this.phone=n.value,this.email=i.value,this.getUniqueUrl()&&this.phone.length&&u.valid(this.email)})});r(this,"checkCookies",()=>{this.visitor_uuid=this.getCookie("aioseo_drip_visitor_uuid")||null});r(this,"getCookie",e=>{var i=document.cookie.match("(^|;) ?"+e+"=([^;]*)(;|$)");return i?i[2]:null});r(this,"setCookie",(e,i,o)=>{var s="";if(o){var n=new Date;n.setTime(n.getTime()+o*24*60*60*1e3),s="; expires="+n.toUTCString()}document.cookie=e+"="+(i||"")+s+"; path=/"});r(this,"getUniqueUrl",()=>{const e="cemail="+encodeURIComponent(this.email)+"&cfname="+encodeURIComponent(this.firstName)+"&clname="+encodeURIComponent(this.lastName)+"&cphone="+encodeURIComponent(this.phone),i=document.querySelector("#aioseo-variations");if(i&&i.dataset.currentVariationId){const n=document.querySelector("input[name=add_to_cart_discount]");return`${window.drip.url}/?add-to-cart=${i.dataset.currentVariationId}&add_coupon=${n==null?void 0:n.value}&${e}`}const o=document.querySelector("input[name=add_to_cart_id]");if(o){const n=document.querySelector("input[name=add_to_cart_discount]");return`${window.drip.url}/?add-to-cart=${o.value}&add_coupon=${n==null?void 0:n.value}&${e}`}const s=document.querySelector(".cart-discount");return s&&s.dataset.uniqueUrl?`${window.drip.url}/${s.dataset.uniqueUrl}?${e}`:null});this.visitor_uuid=null,this.firstName="",this.lastName="",this.email="",this.phone="",this.init()}init(){if(document.readyState!=="complete"&&document.readyState!=="interactive"){setTimeout(()=>{this.init()},50);return}this.bindCheckoutEvents(),this.checkCookies()}}new p;
